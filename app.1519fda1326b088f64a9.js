(()=>{"use strict";(()=>{const e=["Zaid Chapman","Leo Phelps","Tia Morgan","Tyson Hobbs","Belen Elliott","Cooper Moon","Amir Barnett","Mercedes Pierce","Meredith James","Laci Gonzales","Marlie Blanchard","Roberto Tran","Izabella Harrington","Justice Smith","Alyson Tapia","Helen Contreras","Adison Crosby","Keely Petersen","Jaylan Landry","Urijah Fischer","Jaiden Garner","Taylor Meyers","Trevon Wu","Kaiya Coleman","Kelly Chaney","Alonso Maxwell","Zion Trevino","Brynlee House","Ivy Reynolds","Sloane Andrews","Georgia Contreras","Mckenzie Butler","Alexander Manning","Efrain Villanueva","Yareli Nolan","Jordon Walton","Sonny Galloway","Saul Bradshaw","Amaris Howard","Aimee Martin","Quentin Mcclain","Dakota Hurley","Erik Bush","Lee Barker","Imani Mata","Nia Cisneros","Yazmin Logan","Emmalee Hensley","Alia Proctor","Gemma Shepherd","Antonio Cisneros","Ireland Nichols","Andres Reyes","Brynlee Mathis","Anderson Oneill","Logan Yoder","Alexis Hill","Sierra Nelson","Ivan Hughes","Jazmine Wiley","Andres Kaufman","Desirae Montgomery","Justus Macias","Cora Fowler","Charles Fitzgerald","Rory Craig","Lucille Mercado","Jaylyn Thomas","Mark Houston","Briley Hayden","Samuel Vasquez","Carlee Benjamin","Devyn Black","Jaylen Logan","Heidi Lee","Ingrid Harris","Christina Le","Hayden Pennington","Tatiana Hayden","Kasen Greene","Camryn Byrd","Desiree Jackson","Kaylynn Cortez","Seamus Singleton","Gaven Frost","Ayanna Savage","Emery Chan","Bronson Rojas","Amiah Randall","Janae Potter","Nola Stevenson","Kayden Stevens","Damarion Reilly","Nathen Delacruz","Jamison Carrillo","Landen Carpenter","Darnell Dominguez","Louis Barry","Kinley Hale","Tommy Allison"].map((e=>({sort:Math.random(),value:e}))).sort(((e,n)=>e.sort-n.sort)).map((e=>e.value)),n={buildingKey:"TestBuilding",buildingName:"TestBuilding"},i={floorUuid:"TestFloor",floorName:"TestFloor"},t={tableUuid:"TestTable",tableName:"TestTable",numberOfSeats:999},a={roomUuid:"TestRoom",roomName:"TestRoom"};const o=JSON.parse('{"integration-url":"https://kosy-software.github.io/google-drive-table-app/"}');var s;!function(s){(s.Debugger||(s.Debugger={})).App=class{constructor(){this.clients=[]}start(e){window.addEventListener("message",(e=>{this.receiveIncomingMessage(e.data,e.source)})),document.getElementById("add-client").onclick=n=>{this.addNewClient(e["integration-url"])}}receiveIncomingMessage(e,n){switch(e.type){case"ready-and-listening":this.log("Ready and listening.");let i=this.clients.filter((e=>e.iframe.contentWindow===n));if(1!==i.length)throw"Could not find the message's source, this should not occur?";{let e={type:"client-has-joined",payload:i[0].info};this.clients.forEach((n=>{this.sendKosyMessageToIntegrationClient(e,n)})),this.sendKosyMessageToIntegrationClient({type:"request-integration-state",payload:{}},this.clients[0])}break;case"receive-integration-state":this.log("Kosy received the integration's current state"),this.clients.filter((e=>!e.initialized)).forEach((n=>{this.sendInitialInfoMessage(n,e.payload),n.initialized=!0}));break;case"relay-message":this.log("Relay message: ",e.payload);let t={type:"receive-message",payload:e.payload};this.clients.forEach((e=>this.sendKosyMessageToIntegrationClient(t,e)));break;case"end-integration":this.log("End integration"),[...this.clients].forEach((e=>this.removeClient(e.info.clientUuid)))}}addNewClient(o){let s=function(o){let s=Date.now().toString(),l=((e,n)=>{let i=n.reduce(((e,n)=>{switch(n.clientLocation.type){case"seated-at-table":e[n.clientLocation.seatNumber]=!0}return e}),new Array(++e.numberOfSeats));for(let n=1;n<=e.numberOfSeats;n++)if(!i[n])return n;throw"No more available unclaimed seats..."})(t,o);return{clientUuid:s,clientName:e[l-1],clientLocation:{type:"seated-at-table",building:n,floor:i,room:a,table:t,seatNumber:l}}}(this.clients.map((e=>e.info))),l={info:s,iframe:function(e,n,i){let t=document.getElementById("clientRoot").content.firstElementChild.cloneNode(!0),a=t.querySelector("iframe");return a.src=n,a.id=e.clientUuid,t.querySelector("button").onclick=n=>{i(e.clientUuid)},document.getElementById("clients").appendChild(t),a}(s,o,(e=>this.removeClient(e))),initialized:!1};this.clients.push(l)}removeClient(e){let n=this.clients.find((n=>n.info.clientUuid==e));this.clients=this.clients.filter((e=>e!=n));let i={type:"client-has-left",payload:n.info};this.clients.forEach((e=>this.sendKosyMessageToIntegrationClient(i,e))),n.iframe.parentElement.remove()}sendInitialInfoMessage(e,n){let i={type:"receive-initial-info",payload:{clients:this.clients.reduce(((e,n)=>(e[n.info.clientUuid]=n.info,e)),{}),currentClientUuid:e.info.clientUuid,initializerClientUuid:this.clients[0].info.clientUuid,currentIntegrationState:n}};this.sendKosyMessageToIntegrationClient(i,e)}sendKosyMessageToIntegrationClient(e,n){n.iframe.contentWindow.postMessage(e,n.iframe.src)}log(...e){console.log("Kosy received: ",...e)}},(new s.Debugger.App).start(o)}(s||(s={}))})()})();